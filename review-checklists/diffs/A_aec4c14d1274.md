# Diff — `A` `pgpm/core/AGENTS.md`

## Navigation
- Prev: [R092_0b696d620e88.md](R092_0b696d620e88.md) | Up: [packages/core.md](../packages/core.md) | Index: [README.md](../README.md) | Diffs: [diffs/README.md](README.md) | Snapshots: [SNAPSHOTS.md](../SNAPSHOTS.md) | Next: [A_ba7ad044fe2c.md](A_ba7ad044fe2c.md)

## Context
- Diff base (merge base for `main...HEAD`): `86d74dc4fce9051df0d2b5bcc163607aba42f009`
- Main tip: `2492d840ab18e5c30cc7a24a7b4959abf5d6b21e`
- Head: `refactor/ensure-new-name-mappings` @ `27ba20cfc1e66cb921f229963ca63a201fcf6952`
- Module: `packages/core`
- Numstat: `+54/-0`
- Reproduce: `git diff main...HEAD -- pgpm/core/AGENTS.md`

## Summary
- File added
- Token deltas: `constructive`: 0 → 7; `@constructive-io/`: 0 → 1; `Constructive`: 0 → 1
- Headings: `Common Workflows (via CLI)`, `Files Worth Knowing`, `Key Concepts`, `PGPM Core Package - Agent Guide`, `Primary Entry Points`, `Typical Module Layout`

## File content (HEAD)
<details>
<summary>Show file</summary>

```md
# PGPM Core Package - Agent Guide

The `@pgpmjs/core` package is the migration, packaging, and dependency-resolution engine used by:

- the `pgpm` CLI (`pgpm/pgpm`)
- the Constructive CLI (`@constructive-io/cli`, which delegates most database commands to `pgpm`)

It provides workspace/module discovery, plan parsing/writing, deployment orchestration, and a low-level migration client.

## Key Concepts

- **Workspace:** Identified by `pgpm.json` or `pgpm.config.js`
- **Module:** Identified by `pgpm.plan` (and typically a Postgres extension `.control` file)
- **Plans:** Sqitch-compatible plan files (`pgpm.plan`) drive ordering, dependencies, and tags

## Primary Entry Points

- **Exports:** `pgpm/core/src/index.ts`
- **High-level orchestration:** `pgpm/core/src/core/class/pgpm.ts` (`PgpmPackage`)
- **Low-level migrations:** `pgpm/core/src/migrate/client.ts` (`PgpmMigrate`)
- **Scaffolding:** `pgpm/core/src/init/client.ts` (`PgpmInit`)

## Files Worth Knowing

- `pgpm/core/src/workspace/paths.ts` – locate workspace/module roots
- `pgpm/core/src/files/plan/*` – plan parsing/generation/writing
- `pgpm/core/src/resolution/deps.ts` – dependency resolution (SQL headers vs plan-driven)
- `pgpm/core/src/packaging/package.ts` – build consolidated SQL package output
- `pgpm/core/src/projects/*` – deploy/revert/verify orchestration helpers

## Typical Module Layout

```
my-module/
├── pgpm.plan
├── my-module.control
├── Makefile
├── deploy/
├── revert/
└── verify/
```

## Common Workflows (via CLI)

Most users hit this via the CLI layer:

- `pgpm init workspace` / `constructive init workspace`
- `pgpm init` / `constructive init`
- `pgpm add <change>` / `constructive add <change>`
- `pgpm deploy` / `constructive deploy`
- `pgpm verify` / `constructive verify`
- `pgpm revert` / `constructive revert`

CLI implementations live in `pgpm/pgpm/src/commands/*`.
```

</details>
