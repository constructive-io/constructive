# Diff — `A` `postgres/pgsql-test/AGENTS.md`

## Navigation
- Prev: [R088_f2a34ceef126.md](R088_f2a34ceef126.md) | Up: [packages/pgsql-test.md](../packages/pgsql-test.md) | Index: [README.md](../README.md) | Diffs: [diffs/README.md](README.md) | Snapshots: [SNAPSHOTS.md](../SNAPSHOTS.md) | Next: [D_f48a15af2a39.md](D_f48a15af2a39.md)

## Context
- Diff base (merge base for `main...HEAD`): `86d74dc4fce9051df0d2b5bcc163607aba42f009`
- Main tip: `2492d840ab18e5c30cc7a24a7b4959abf5d6b21e`
- Head: `refactor/ensure-new-name-mappings` @ `27ba20cfc1e66cb921f229963ca63a201fcf6952`
- Module: `packages/pgsql-test`
- Numstat: `+42/-0`
- Reproduce: `git diff main...HEAD -- postgres/pgsql-test/AGENTS.md`

## Summary
- File added
- Token deltas: `Constructive`: 0 → 2
- Headings: `Main API`, `Seeding Notes`, `Where To Look`, `pgsql-test Package - Agent Guide`

## File content (HEAD)
<details>
<summary>Show file</summary>

```md
# pgsql-test Package - Agent Guide

The `pgsql-test` package provides fast, isolated PostgreSQL databases for integration testing.

It’s used throughout the Constructive/PGPM monorepo for:

- module/migration tests (PGPM)
- PostGraphile/GraphQL integration tests (Constructive GraphQL packages)
- S3/MinIO upload tests that need database + API wiring

## Main API

- `getConnections(connectionOptions?, seedAdapters?)` – creates an isolated test database and returns clients plus a `teardown()` function
- `seed.*` – helpers for seeding (`sqlfile`, `fn`, `csv`, and PGPM/Sqitch-style module seeding)

Typical Jest pattern:

```ts
import { getConnections } from 'pgsql-test';

let db, teardown;

beforeAll(async () => {
  ({ db, teardown } = await getConnections());
});

afterAll(() => teardown());
beforeEach(() => db.beforeEach());
afterEach(() => db.afterEach());
```

## Seeding Notes

- For raw SQL seeding, use `seed.sqlfile([...paths])`.
- For module-based seeding (deploying a module/workspace into the test DB), use the PGPM seed adapter (e.g. `seed.pgpm(cwd)`).

## Where To Look

- `postgres/pgsql-test/src/connect.ts` – connection/bootstrap logic
- `postgres/pgsql-test/src/test-client.ts` – `PgTestClient` helpers (`beforeEach`, `afterEach`, `setContext`, etc.)
- `postgres/pgsql-test/src/seed/*` – seed adapters
- `postgres/pgsql-test/__tests__/*` – usage examples
```

</details>
