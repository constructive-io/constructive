# Diff — `A` `postgres/pgsql-test/AGENTS.md`

## Context
- Base: `main` @ `86d74dc4fce9051df0d2b5bcc163607aba42f009`
- Head: `refactor/ensure-new-name-mappings` @ `bd9be723c96aeb1f9f69e4946acbd9241ee8da50`
- Merge base: `86d74dc4fce9051df0d2b5bcc163607aba42f009`
- Numstat: `+42/-0`
- Reproduce: `git diff main...HEAD -- postgres/pgsql-test/AGENTS.md`

## Guideline token summary
- Deltas: `Constructive`: 0 → 2

## File content (HEAD)
```md
# pgsql-test Package - Agent Guide

The `pgsql-test` package provides fast, isolated PostgreSQL databases for integration testing.

It’s used throughout the Constructive/PGPM monorepo for:

- module/migration tests (PGPM)
- PostGraphile/GraphQL integration tests (Constructive GraphQL packages)
- S3/MinIO upload tests that need database + API wiring

## Main API

- `getConnections(connectionOptions?, seedAdapters?)` – creates an isolated test database and returns clients plus a `teardown()` function
- `seed.*` – helpers for seeding (`sqlfile`, `fn`, `csv`, and PGPM/Sqitch-style module seeding)

Typical Jest pattern:

```ts
import { getConnections } from 'pgsql-test';

let db, teardown;

beforeAll(async () => {
  ({ db, teardown } = await getConnections());
});

afterAll(() => teardown());
beforeEach(() => db.beforeEach());
afterEach(() => db.afterEach());
```

## Seeding Notes

- For raw SQL seeding, use `seed.sqlfile([...paths])`.
- For module-based seeding (deploying a module/workspace into the test DB), use the PGPM seed adapter (e.g. `seed.pgpm(cwd)`).

## Where To Look

- `postgres/pgsql-test/src/connect.ts` – connection/bootstrap logic
- `postgres/pgsql-test/src/test-client.ts` – `PgTestClient` helpers (`beforeEach`, `afterEach`, `setContext`, etc.)
- `postgres/pgsql-test/src/seed/*` – seed adapters
- `postgres/pgsql-test/__tests__/*` – usage examples
```
