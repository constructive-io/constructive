"""A universally unique identifier as defined by [RFC 4122](https://tools.ietf.org/html/rfc4122)."""
scalar UUID

"""
A point in time as described by the [ISO
8601](https://en.wikipedia.org/wiki/ISO_8601) standard. May or may not include a timezone.
"""
scalar Datetime

"""A location as described by the [GeoJSON](https://geojson.org/) format."""
scalar JSON

"""A string representing a cursor for pagination."""
scalar Cursor

"""The root query type."""
type Query {
  """Reads and enables pagination through a set of `User`."""
  users(
    first: Int
    last: Int
    offset: Int
    before: Cursor
    after: Cursor
    orderBy: [UsersOrderBy!] = [PRIMARY_KEY_ASC]
    filter: UserFilter
    condition: UserCondition
  ): UsersConnection

  """Reads a single `User` using its globally unique `ID`."""
  user(id: UUID!): User

  """Reads and enables pagination through a set of `Post`."""
  posts(
    first: Int
    last: Int
    offset: Int
    before: Cursor
    after: Cursor
    orderBy: [PostsOrderBy!] = [PRIMARY_KEY_ASC]
    filter: PostFilter
    condition: PostCondition
  ): PostsConnection

  """Reads a single `Post` using its globally unique `ID`."""
  post(id: UUID!): Post

  """Reads and enables pagination through a set of `Comment`."""
  comments(
    first: Int
    last: Int
    offset: Int
    before: Cursor
    after: Cursor
    orderBy: [CommentsOrderBy!] = [PRIMARY_KEY_ASC]
    filter: CommentFilter
  ): CommentsConnection

  """Reads a single `Comment` using its globally unique `ID`."""
  comment(id: UUID!): Comment

  """Reads and enables pagination through a set of `Tag`."""
  tags(
    first: Int
    last: Int
    offset: Int
    before: Cursor
    after: Cursor
    orderBy: [TagsOrderBy!] = [PRIMARY_KEY_ASC]
  ): TagsConnection

  """The currently authenticated user."""
  currentUser: User

  """Search users by name or email."""
  searchUsers(query: String!): [User!]
}

"""The root mutation type."""
type Mutation {
  """Creates a single `User`."""
  createUser(input: CreateUserInput!): CreateUserPayload

  """Updates a single `User` using its globally unique `ID`."""
  updateUser(input: UpdateUserInput!): UpdateUserPayload

  """Deletes a single `User` using its globally unique `ID`."""
  deleteUser(input: DeleteUserInput!): DeleteUserPayload

  """Creates a single `Post`."""
  createPost(input: CreatePostInput!): CreatePostPayload

  """Updates a single `Post` using its globally unique `ID`."""
  updatePost(input: UpdatePostInput!): UpdatePostPayload

  """Deletes a single `Post` using its globally unique `ID`."""
  deletePost(input: DeletePostInput!): DeletePostPayload

  """Creates a single `Comment`."""
  createComment(input: CreateCommentInput!): CreateCommentPayload

  """Updates a single `Comment` using its globally unique `ID`."""
  updateComment(input: UpdateCommentInput!): UpdateCommentPayload

  """Deletes a single `Comment` using its globally unique `ID`."""
  deleteComment(input: DeleteCommentInput!): DeleteCommentPayload

  """Creates a single `Tag`."""
  createTag(input: CreateTagInput!): CreateTagPayload

  """Authenticate a user and return a JWT token."""
  login(email: String!, password: String!): LoginPayload

  """Register a new user account."""
  register(username: String!, email: String!, password: String!): RegisterPayload
}

# ============================================================================
# Entity Types
# ============================================================================

type User {
  id: UUID!
  username: String!
  email: String!
  displayName: String
  bio: String
  role: UserRole!
  isActive: Boolean!
  createdAt: Datetime!
  updatedAt: Datetime

  """Reads and enables pagination through a set of `Post`."""
  posts(
    first: Int
    last: Int
    offset: Int
    before: Cursor
    after: Cursor
    orderBy: [PostsOrderBy!] = [PRIMARY_KEY_ASC]
    filter: PostFilter
  ): PostsConnection!

  """Reads and enables pagination through a set of `Comment`."""
  comments(
    first: Int
    last: Int
    offset: Int
    before: Cursor
    after: Cursor
  ): CommentsConnection!
}

type Post {
  id: UUID!
  title: String!
  content: String
  slug: String!
  status: PostStatus!
  authorId: UUID!
  publishedAt: Datetime
  createdAt: Datetime!
  updatedAt: Datetime

  """Reads the `User` that authored this post."""
  author: User

  """Reads and enables pagination through a set of `Comment`."""
  comments(
    first: Int
    last: Int
    offset: Int
    before: Cursor
    after: Cursor
  ): CommentsConnection!

  """Reads and enables pagination through a set of `Tag`."""
  tags(
    first: Int
    last: Int
    offset: Int
    before: Cursor
    after: Cursor
  ): TagsConnection!
}

type Comment {
  id: UUID!
  body: String!
  postId: UUID!
  authorId: UUID!
  createdAt: Datetime!
  updatedAt: Datetime

  """The post this comment belongs to."""
  post: Post

  """The user who authored this comment."""
  author: User
}

type Tag {
  id: UUID!
  name: String!
  slug: String!
  createdAt: Datetime!
}

# ============================================================================
# Enums
# ============================================================================

enum UserRole {
  ADMIN
  EDITOR
  USER
  GUEST
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum UsersOrderBy {
  NATURAL
  PRIMARY_KEY_ASC
  PRIMARY_KEY_DESC
  ID_ASC
  ID_DESC
  USERNAME_ASC
  USERNAME_DESC
  EMAIL_ASC
  EMAIL_DESC
  CREATED_AT_ASC
  CREATED_AT_DESC
}

enum PostsOrderBy {
  NATURAL
  PRIMARY_KEY_ASC
  PRIMARY_KEY_DESC
  ID_ASC
  ID_DESC
  TITLE_ASC
  TITLE_DESC
  CREATED_AT_ASC
  CREATED_AT_DESC
  PUBLISHED_AT_ASC
  PUBLISHED_AT_DESC
}

enum CommentsOrderBy {
  NATURAL
  PRIMARY_KEY_ASC
  PRIMARY_KEY_DESC
  ID_ASC
  ID_DESC
  CREATED_AT_ASC
  CREATED_AT_DESC
}

enum TagsOrderBy {
  NATURAL
  PRIMARY_KEY_ASC
  PRIMARY_KEY_DESC
  ID_ASC
  ID_DESC
  NAME_ASC
  NAME_DESC
}

# ============================================================================
# Connection Types
# ============================================================================

type UsersConnection {
  nodes: [User!]!
  edges: [UsersEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type UsersEdge {
  node: User!
  cursor: Cursor!
}

type PostsConnection {
  nodes: [Post!]!
  edges: [PostsEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type PostsEdge {
  node: Post!
  cursor: Cursor!
}

type CommentsConnection {
  nodes: [Comment!]!
  edges: [CommentsEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type CommentsEdge {
  node: Comment!
  cursor: Cursor!
}

type TagsConnection {
  nodes: [Tag!]!
  edges: [TagsEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type TagsEdge {
  node: Tag!
  cursor: Cursor!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: Cursor
  endCursor: Cursor
}

# ============================================================================
# Filter Types
# ============================================================================

input UserFilter {
  id: UUIDFilter
  username: StringFilter
  email: StringFilter
  role: UserRoleFilter
  isActive: BooleanFilter
  and: [UserFilter!]
  or: [UserFilter!]
  not: UserFilter
}

input PostFilter {
  id: UUIDFilter
  title: StringFilter
  status: PostStatusFilter
  authorId: UUIDFilter
  and: [PostFilter!]
  or: [PostFilter!]
  not: PostFilter
}

input CommentFilter {
  id: UUIDFilter
  postId: UUIDFilter
  authorId: UUIDFilter
  and: [CommentFilter!]
  or: [CommentFilter!]
  not: CommentFilter
}

input UUIDFilter {
  equalTo: UUID
  notEqualTo: UUID
  in: [UUID!]
  notIn: [UUID!]
  isNull: Boolean
}

input StringFilter {
  equalTo: String
  notEqualTo: String
  in: [String!]
  notIn: [String!]
  includes: String
  startsWith: String
  endsWith: String
  isNull: Boolean
}

input BooleanFilter {
  equalTo: Boolean
  notEqualTo: Boolean
  isNull: Boolean
}

input UserRoleFilter {
  equalTo: UserRole
  notEqualTo: UserRole
  in: [UserRole!]
  notIn: [UserRole!]
}

input PostStatusFilter {
  equalTo: PostStatus
  notEqualTo: PostStatus
  in: [PostStatus!]
  notIn: [PostStatus!]
}

# ============================================================================
# Condition Types
# ============================================================================

input UserCondition {
  id: UUID
  username: String
  email: String
}

input PostCondition {
  id: UUID
  title: String
  authorId: UUID
}

# ============================================================================
# Mutation Input Types
# ============================================================================

input CreateUserInput {
  clientMutationId: String
  user: UserInput!
}

input UserInput {
  username: String!
  email: String!
  displayName: String
  bio: String
  role: UserRole
}

input UpdateUserInput {
  clientMutationId: String
  id: UUID!
  patch: UserPatch!
}

input UserPatch {
  username: String
  email: String
  displayName: String
  bio: String
  role: UserRole
  isActive: Boolean
}

input DeleteUserInput {
  clientMutationId: String
  id: UUID!
}

input CreatePostInput {
  clientMutationId: String
  post: PostInput!
}

input PostInput {
  title: String!
  content: String
  slug: String!
  status: PostStatus
  authorId: UUID!
}

input UpdatePostInput {
  clientMutationId: String
  id: UUID!
  patch: PostPatch!
}

input PostPatch {
  title: String
  content: String
  slug: String
  status: PostStatus
  publishedAt: Datetime
}

input DeletePostInput {
  clientMutationId: String
  id: UUID!
}

input CreateCommentInput {
  clientMutationId: String
  comment: CommentInput!
}

input CommentInput {
  body: String!
  postId: UUID!
  authorId: UUID!
}

input UpdateCommentInput {
  clientMutationId: String
  id: UUID!
  patch: CommentPatch!
}

input CommentPatch {
  body: String
}

input DeleteCommentInput {
  clientMutationId: String
  id: UUID!
}

input CreateTagInput {
  clientMutationId: String
  tag: TagInput!
}

input TagInput {
  name: String!
  slug: String!
}

# ============================================================================
# Mutation Payload Types
# ============================================================================

type CreateUserPayload {
  clientMutationId: String
  user: User
}

type UpdateUserPayload {
  clientMutationId: String
  user: User
}

type DeleteUserPayload {
  clientMutationId: String
  user: User
}

type CreatePostPayload {
  clientMutationId: String
  post: Post
}

type UpdatePostPayload {
  clientMutationId: String
  post: Post
}

type DeletePostPayload {
  clientMutationId: String
  post: Post
}

type CreateCommentPayload {
  clientMutationId: String
  comment: Comment
}

type UpdateCommentPayload {
  clientMutationId: String
  comment: Comment
}

type DeleteCommentPayload {
  clientMutationId: String
  comment: Comment
}

type CreateTagPayload {
  clientMutationId: String
  tag: Tag
}

# ============================================================================
# Custom Operation Payload Types
# ============================================================================

type LoginPayload {
  token: String!
  user: User!
}

type RegisterPayload {
  token: String!
  user: User!
}
